<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-area {
            border: 2px dashed #ccc;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .test-area:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .test-area:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 50px;
        }
        
        .hidden {
            display: none;
        }
        
        .method-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>File Upload Browser Compatibility Test</h1>
    
    <div class="test-area" id="uploadArea" tabindex="0" role="button" aria-label="Click to upload file">
        <h3>Click here to test file upload</h3>
        <p>This should work in all browsers including Brave</p>
        <input type="file" id="fileInput" accept=".html,.htm" class="hidden">
    </div>
    
    <div class="result" id="result">
        <strong>Status:</strong> <span id="status">Ready to test</span>
        <div id="fileInfo"></div>
        <div class="method-info" id="methodInfo"></div>
    </div>
    
    <script>
        let methodUsed = '';
        
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const status = document.getElementById('status');
            const fileInfo = document.getElementById('fileInfo');
            const methodInfo = document.getElementById('methodInfo');
            
            // Detect browser
            const userAgent = navigator.userAgent;
            const browserInfo = getBrowserInfo(userAgent);
            status.textContent = `Ready to test - Browser: ${browserInfo}`;
            
            function getBrowserInfo(ua) {
                if (ua.includes('Brave')) return 'Brave';
                if (ua.includes('Chrome')) return 'Chrome';
                if (ua.includes('Firefox')) return 'Firefox';
                if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
                if (ua.includes('Edge')) return 'Edge';
                return 'Unknown';
            }
            
            function triggerFileInput() {
                const methods = [
                    {
                        name: 'Direct click()',
                        fn: () => fileInput.click()
                    },
                    {
                        name: 'MouseEvent dispatch',
                        fn: () => {
                            const event = new MouseEvent('click', {
                                view: window,
                                bubbles: true,
                                cancelable: true
                            });
                            fileInput.dispatchEvent(event);
                        }
                    },
                    {
                        name: 'Focus + Enter key',
                        fn: () => {
                            fileInput.focus();
                            const event = new KeyboardEvent('keydown', {
                                key: 'Enter',
                                keyCode: 13,
                                bubbles: true
                            });
                            fileInput.dispatchEvent(event);
                        }
                    },
                    {
                        name: 'createElement click',
                        fn: () => {
                            const tempInput = document.createElement('input');
                            tempInput.type = 'file';
                            tempInput.accept = '.html,.htm';
                            tempInput.style.display = 'none';
                            document.body.appendChild(tempInput);
                            tempInput.click();
                            tempInput.addEventListener('change', function(e) {
                                if (e.target.files[0]) {
                                    const event = new Event('change', { bubbles: true });
                                    Object.defineProperty(event, 'target', {
                                        value: e.target,
                                        enumerable: true
                                    });
                                    fileInput.dispatchEvent(event);
                                }
                                document.body.removeChild(tempInput);
                            });
                        }
                    }
                ];
                
                for (let i = 0; i < methods.length; i++) {
                    try {
                        status.textContent = `Trying method ${i + 1}: ${methods[i].name}...`;
                        methods[i].fn();
                        methodUsed = methods[i].name;
                        break;
                    } catch (err) {
                        console.log(`Method ${i + 1} failed:`, err);
                        if (i === methods.length - 1) {
                            status.textContent = `All methods failed. Browser: ${browserInfo}`;
                            methodInfo.textContent = 'Error: Could not trigger file input';
                        }
                    }
                }
            }
            
            // Click handler
            uploadArea.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                triggerFileInput();
            });
            
            // Keyboard handler
            uploadArea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    triggerFileInput();
                }
            });
            
            // File change handler
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    status.textContent = `✅ SUCCESS! File selected: ${file.name}`;
                    fileInfo.innerHTML = `
                        <strong>File Details:</strong><br>
                        Name: ${file.name}<br>
                        Size: ${(file.size / 1024).toFixed(2)} KB<br>
                        Type: ${file.type}<br>
                        Last Modified: ${new Date(file.lastModified).toLocaleString()}
                    `;
                    methodInfo.textContent = `Method used: ${methodUsed} on ${browserInfo}`;
                } else {
                    status.textContent = '❌ No file selected';
                    fileInfo.innerHTML = '';
                    methodInfo.textContent = '';
                }
            });
        });
    </script>
</body>
</html>